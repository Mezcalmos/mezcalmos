# Get customer's order
subscription listen_on_restaurant_order_by_id($order_id: Int!) {
  restaurant_order_by_pk(id: $order_id) {
    id
    notes
    scheduled_time
    restaurant {
      id
      firebase_id
      image
      language_id
      location_gps
      location_text
      name
    }
    items {
      in_json
      restaurant_item {
        id
        image
        item_type
        name {
          translations {
            language_id
            value
          }
        }
        description {
          translations {
            language_id
            value
          }
        }
        position
        category_id
        available
        restaurant_id
        special_period_end
        special_period_start
        archived
        cost
      }
      cost_per_one
      id
      notes
      quantity
    }
    payment_type
    to_location_gps
    to_location_address
    estimated_food_ready_time
    actual_food_ready_time
    refund_amount
    delivery_id
    status
    review_id
    review {
      created_at
      from_entity_id
      from_entity_type
      id
      note
      rating
      to_entity_id
      to_entity_type
      customer {
        user {
          id
          image
          name
        }
      }
    }
    order_type
    order_time
    firebase_id
    customer_app_type
    notes
    customer {
      user {
        id
        name
        image
      }
    }
    tax
    total_cost
    items_cost
    chat_id
    delivery_cost
    delivery {
      actual_delivered_time
      actual_package_ready_time
      actual_arrival_at_pickup_time
      actual_arrival_at_dropoff_time
      chat_with_service_provider_id
      cancellation_time
      current_gps

      delivery_cost

      delivery_driver {
         current_location
       
       
        user {
          id
          image
          name
          firebase_id
          language_id
        }
      }
    }
  }
}
query get_restaurant_order_by_id($order_id: Int!) {
  restaurant_order_by_pk(id: $order_id) {
    id
    notes
    scheduled_time
    restaurant {
      id
      firebase_id
      image
      language_id
      location_gps
      location_text
      name
    }
    items {
      in_json
      restaurant_item {
        item_type
        name {
          translations {
            language_id
            value
          }
        }
        description {
          translations {
            language_id
            value
          }
        }
        position
        category_id
        available
        id
        image
        restaurant_id
        special_period_end
        special_period_start
        archived
        cost
      }
      cost_per_one
      id
      notes
      quantity
    }
    payment_type
    to_location_gps
    to_location_address
    estimated_food_ready_time
    actual_food_ready_time
    refund_amount
    delivery_id
    status
    review_id
    review {
      created_at
      from_entity_id
      from_entity_type
      id
      note
      rating
      to_entity_id
      to_entity_type
      customer {
        user {
          id
          image
          name
        }
      }
    }
    order_type
    order_time
    firebase_id
    customer_app_type
    notes
    tax
    total_cost
    items_cost
    chat_id
    customer {
      user {
        id
        name
        image
      }
    }
    delivery_cost
    delivery {
      chat_with_service_provider_id
      id
      actual_delivered_time
      actual_package_ready_time
      actual_arrival_at_pickup_time
      actual_arrival_at_dropoff_time
      cancellation_time
      current_gps

      delivery_cost
      delivery_driver {
       
        current_location
       
       
        user {
          id
          image
          name
          firebase_id
          language_id
        }
      }
    }
  }
}

subscription listen_restaurant_current_orders($restaurantId: Int!) {
  restaurant_order(
    where: { restaurant_id: { _eq: $restaurantId }, in_process: { _eq: true } }
  ) {
    id
    order_time
    status
    total_cost
    to_location_address
    customer {
      user {
        name
        image
      }
    }
  }
}
query get_restaurant_current_orders($restaurantId: Int!) {
  restaurant_order(
    where: { restaurant_id: { _eq: $restaurantId }, in_process: { _eq: true } }
  ) {
    id
    order_time
    status

    total_cost
    to_location_address
    customer {
      user {
        name
        image
      }
    }
  }
}
query get_restaurant_past_orders($restaurantId: Int!) {
  restaurant_order(
    where: { restaurant_id: { _eq: $restaurantId }, in_process: { _eq: false } }
  ) {
    id
    order_time
    status

    total_cost
    to_location_address
    customer {
      user {
        name
        image
      }
    }
  }
}

mutation setRestaurantOrderEstFoodReadyTime(
  $orderId: Int!
  $time: timestamptz!
) {
  update_restaurant_order_by_pk(
    pk_columns: { id: $orderId }
    _set: { estimated_food_ready_time: $time }
  ) {
    estimated_food_ready_time
  }
}
mutation assignRestaurantOrderReview($orderId: Int!, $reviewId: Int!) {
  update_restaurant_order_by_pk(
    pk_columns: { id: $orderId }
    _set: { review_id: $reviewId }
  ) {
    review_id
    review {
      created_at
      from_entity_id
      from_entity_type
      id
      note
      rating
      to_entity_id
      to_entity_type
    }
  }
}
