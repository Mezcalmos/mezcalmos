fragment deliveryMessageFields on delivery_messages {
  id
  entry
  phone_number
  driver_id
  received_time
  finished_time
  responded_time
  show_driver_info
  customer {
    name
    image
  }
}

fragment deliveryMessageWithDriver on delivery_messages {
  ...deliveryMessageFields
  driver {
    user {
      name
      phone
    }
  }
}

query GetPastDeliveryMessages($driver_id: Int!, $limit: Int!, $offset: Int!) {
  delivery_messages(
    distinct_on: [phone_number, received_time]
    limit: $limit
    offset: $offset
    order_by: { received_time: desc, phone_number: desc }
    where: {
      driver_id: { _eq: $driver_id }
      finished_time: { _is_null: false }
    }
  ) {
    ...deliveryMessageFields
  }
}

query GetCurrentDeliveryMessages($driver_id: Int!) {
  delivery_messages(
    distinct_on: [phone_number, received_time]
    order_by: { received_time: desc, phone_number: desc }
    where: { driver_id: { _eq: $driver_id }, finished_time: { _is_null: true } }
  ) {
    ...deliveryMessageFields
  }
}

subscription listenCurrentDeliveryMessages($driver_id: Int!) {
  delivery_messages(
    distinct_on: phone_number
    where: { driver_id: { _eq: $driver_id }, finished_time: { _is_null: true } }
  ) {
    ...deliveryMessageWithDriver
  }
}

query GetOpenDeliveryMessages {
  delivery_open_delivery_messages(
    distinct_on: phone_number
  ) {
    id
    entry
    phone_number
    driver_id
    received_time
    finished_time
    responded_time
    customer {
      name
      image
    }
  }
}

subscription ListenOpenDeliveryMessages {
  delivery_open_delivery_messages(
    distinct_on: phone_number
  ) {
    id
    entry
    phone_number
    driver_id
    received_time
    finished_time
    responded_time
    customer {
      name
      image
    }
  }
}

query GetAllCurrentDeliveryMessages($driver_id: Int!) {
  delivery_messages(
    distinct_on: [phone_number, received_time]
    order_by: { received_time: desc, phone_number: desc }
    where: {finished_time: { _is_null: true } }
  ) {
    ...deliveryMessageFields
  }
}

subscription listenAllCurrentDeliveryMessages($driver_id: Int!) {
  delivery_messages(
    distinct_on: phone_number
    where: {finished_time: { _is_null: true } }
  ) {
    ...deliveryMessageWithDriver
  }
}

query GetCustomerDeliveryMessages($phone_number: String!) {
  delivery_messages(
    where: { phone_number: { _eq: $phone_number } }
    order_by: { received_time: asc }
  ) {
    ...deliveryMessageWithDriver
  }
}