query get_service_provider_offers(
  $service_provider_id: Int
  $service_provider_type: String
) {
  service_provider_offer(
    where: {
      service_provider_id: { _eq: $service_provider_id }
      service_provider_type: { _eq: $service_provider_type }
    }
  ) {
    id
    details
    name {
      translations {
        language_id
        value
      }
    }
    status
    coupon_code
    offer_type
    influencer_details
  }
}

query check_coupon(
  $coupon_code: String
  $service_provider_id: Int
  $service_provider_type: String
) {
  service_provider_offer(
    where: {
      coupon_code: { _eq: $coupon_code }
      service_provider_id: { _eq: $service_provider_id }
      service_provider_type: { _eq: $service_provider_type }
      status: { _eq: "active" }
      offer_type: { _eq: "coupon" }
    }
  ) {
    id
    details
  }
}

query check_offer_applied(
  $offer_id: Int
  $customer_id: Int
  $order_type: String
) {
  service_provider_offer_applied(
    where: {
      offer_id: { _eq: $offer_id }
      order_type: { _eq: $order_type }
      _or: [
        { business_order: { customer_id: { _eq: $customer_id } } }
        { restaurant_order: { customer_id: { _eq: $customer_id } } }
        { laundry_order: { customer_id: { _eq: $customer_id } } }
      ]
    }
  ) {
    order_id
  }
}

query fetchPromotions(
  $service_provider_id: Int
  $service_provider_type: String
) {
  service_provider_offer(
    where: {
      offer_type: { _eq: "promotion" }
      service_provider_id: { _eq: $service_provider_id }
      service_provider_type: { _eq: $service_provider_type }
      status: { _eq: "active" }
    }
  ) {
    details
    id
    name {
      translations {
        language_id
        value
      }
    }
    name_id
  }
}

query fetch_subscribed_promotions(
  $customer_id: Int
  $limit: Int
  $offset: Int
) {
  service_provider_offer(
    limit: $limit
    offset: $offset
    where: {
      _or: [
        { business: { subscribers: { customer_id: { _eq: $customer_id } } } }
        { laundry: { subscribers: { customer_id: { _eq: $customer_id } } } }
        {
          delivery_company: {
            subscribers: { customer_id: { _eq: $customer_id } }
          }
        }
        { restaurant: { subscribers: { customer_id: { _eq: $customer_id } } } }
      ]
      offer_type: { _eq: "promotion" }
      status: { _eq: "active" }
    }
  ) {
    id
    details
    name {
      id
      translations {
        language_id
        value
      }
    }
    service_provider_id
    service_provider_type
    restaurant {
      details {
        name
        image
      }
    }
    laundry {
      details {
        name
        image
      }
    }
    delivery_company {
      details {
        name
        image
      }
    }
    business {
      details {
        name
        image
      }
    }
  }
}

query fetch_all_promotions_within_distance(
  $from: geography!
  $distance: Float!
  $limit: Int
  $offset: Int
) {
  service_provider_offer(
    limit: $limit
    offset: $offset
    where: {
      _or: [
        {
          business: {
            details: {
              location: {
                gps: { _st_d_within: { distance: $distance, from: $from } }
              }
            }
          }
        }
        {
          laundry: {
            details: {
              location: {
                gps: { _st_d_within: { distance: $distance, from: $from } }
              }
            }
          }
        }
        {
          delivery_company: {
            details: {
              location: {
                gps: { _st_d_within: { distance: $distance, from: $from } }
              }
            }
          }
        }
        {
          restaurant: {
            details: {
              location: {
                gps: { _st_d_within: { distance: $distance, from: $from } }
              }
            }
          }
        }
      ]
      offer_type: { _eq: "promotion" }
      status: { _eq: "active" }
    }
  ) {
    id
    details
    name {
      id
      translations {
        language_id
        value
      }
    }
    service_provider_id
    service_provider_type
    restaurant {
      details {
        name
        image
      }
    }
    laundry {
      details {
        name
        image
      }
    }
    delivery_company {
      details {
        name
        image
      }
    }
    business {
      details {
        name
        image
      }
    }
  }
}
mutation insertOfferApplied(
  $object: service_provider_offer_applied_insert_input!
) {
  insert_service_provider_offer_applied_one(object: $object) {
    id
  }
}
query getInfluencerIdByTag($tag: String!) {
  service_provider_influencer(where: { tag: { _eq: $tag } }) {
    id
  }
}
query getOfferTotalRevenue($offer_id: Int!) {
  service_provider_offer_applied_aggregate(
    where: { offer_id: { _eq: $offer_id } }
  ) {
    aggregate {
      sum {
        order_total
      }
    }
  }
}
query getOfferTotalLoss($offer_id: Int!) {
  service_provider_offer_applied_aggregate(
    where: { offer_id: { _eq: $offer_id } }
  ) {
    aggregate {
      sum {
        loss
      }
    }
  }
}

query getOfferAppliedByOffer($offer_id: Int!) {
  service_provider_offer_applied(
    where: { offer_id: { _eq: $offer_id } }
    order_by: { restaurant_order: { order_time: desc } }
  ) {
    comission
    discount
    id
    influencer_id
    loss
    offer_id
    order_id
    order_total
    order_type
    influencer {
      id
      user {
        id
        phone
        image
        name
      }
    }
    offer {
      influencer_details
    }
    restaurant {
      id
      details {
        image
        name
        phone_number
        location {
          gps
          address
        }
      }
    }
    restaurant_order {
      restaurant {
        id
        details {
          image
          name
          phone_number
          location {
            gps
            address
          }
        }
      }
      customer {
        user {
          id
          phone
          image
          name
        }
      }
    }
  }
}
mutation insertInfluencerPayout(
  $object: service_provider_influencer_payouts_insert_input!
) {
  insert_service_provider_influencer_payouts_one(object: $object) {
    id
    influencer_id
    amount
    date
    sp_id
    sp_type
  }
}
query GetServiceInfluencerPayoutsSum(
  $serviceId: Int!
  $influencerId: Int!
  $serviceType: String!
) {
  service_provider_influencer_payouts_aggregate(
    where: {
      influencer_id: { _eq: $influencerId }
      sp_id: { _eq: $serviceId }
      sp_type: { _eq: $serviceType }
    }
  ) {
    aggregate {
      sum {
        amount
      }
    }
    # nodes {
    #   amount
    #   date
    #   id
    #   influencer_id
    #   sp_id
    #   sp_type
    # }
  }
}
query GetInfluencerPayouts($influencerId: Int!) {
  service_provider_influencer_payouts(
    order_by: { date: desc }
    where: { influencer_id: { _eq: $influencerId } }
  ) {
    id
    influencer_id
    sp_id
    amount
    sp_type
    date
    influencer {
      id
      user {
        id
        phone
        image
        name
      }
    }

    restaurant {
      id
      details {
        image
        name
        phone_number
        location {
          gps
          address
        }
      }
    }
  }
}
