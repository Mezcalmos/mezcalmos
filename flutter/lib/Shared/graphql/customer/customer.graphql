# Set app_version of customer
mutation set_customer_app_version($customer_id: Int!, $version: String!) {
  update_customer_customer_by_pk(
    pk_columns: { user_id: $customer_id }
    _set: { app_version: $version }
  ) {
    app_version
  }
}

mutation set_notif_token($customer_id: Int!, $token: String!) {
  update_notification_info(
    where: { user_id: { _eq: $customer_id } }
    _set: { token: $token }
  ) {
    returning {
      token
    }
  }
}

# Get customer's infos
query get_customer_info($customer_id: Int!) {
  customer_customer(where: { user_id: { _eq: $customer_id } }) {
    app_version
    notification_info {
      token
      turn_off_notifications
    }
    user {
      id
      name
      image
      email
      phone
      language_id
    }
    stripe_info
    saved_locations(where: { customer_id: { _eq: $customer_id } }) {
      id
      name
      location_gps
      location_text
      default
    }
  }
}
query get_customer_stripe_info($customer_id: Int!) {
  customer_customer(where: { user_id: { _eq: $customer_id } }) {
    stripe_info
  }
}

# Set customer's infos
mutation set_customer_info(
  $user_id: Int!
  $app_version: String!
  $stripe_info: jsonb
) {
  insert_customer_customer_one(
    object: {
      user_id: $user_id
      app_version: $app_version
      stripe_info: $stripe_info
    }
  ) {
    user_id
  }
}
mutation set_customer_stripe_info($user_id: Int!, $stripe_info: jsonb) {
  update_customer_customer_by_pk(
    pk_columns: { user_id: $user_id }
    _set: { stripe_info: $stripe_info }
  ) {
    stripe_info
  }
}
query get_customer_orders($custId: Int!,$inProcess: Boolean!) {
  customer_minimal_orders(args: {customer_id: $custId}, where: {in_process: {_eq: $inProcess}}) {
    id
    image
    in_process
    name
    order_time
    order_type
    payment_type
    status
    total_cost
  }
}
subscription listen_on_customer_orders($custId: Int!,$inProcess: Boolean!) {
  customer_minimal_orders(args: {customer_id: $custId}, where: {in_process: {_eq: $inProcess}}) {
    id
    image
    in_process
    name
    order_time
    order_type
    payment_type
    status
    total_cost
  }
}
