table:
  name: offer_applied
  schema: service_provider
object_relationships:
  - name: business_order
    using:
      manual_configuration:
        column_mapping:
          order_id: id
          order_type: order_type
        insertion_order: null
        remote_table:
          name: order_request
          schema: business
  - name: influencer
    using:
      manual_configuration:
        column_mapping:
          influencer_id: id
        insertion_order: null
        remote_table:
          name: influencer
          schema: service_provider
  - name: laundry_order
    using:
      manual_configuration:
        column_mapping:
          order_id: id
          order_type: order_type
        insertion_order: null
        remote_table:
          name: order
          schema: laundry
  - name: offer
    using:
      foreign_key_constraint_on: offer_id
  - name: restaurant_order
    using:
      manual_configuration:
        column_mapping:
          order_id: id
          order_type: order_type
        insertion_order: null
        remote_table:
          name: order
          schema: restaurant
computed_fields:
  - name: loss
    definition:
      function:
        name: offer_loss
        schema: service_provider
insert_permissions:
  - role: restaurant_operator
    permission:
      check:
        _or:
          - order_id:
              _is_null: true
          - restaurant_order:
              restaurant:
                restaurant_operators:
                  user_id:
                    _eq: X-Hasura-User-Id
      columns:
        - comission
        - discount
        - influencer_id
        - offer_id
        - order_id
        - order_total
        - order_type
    comment: ""
select_permissions:
  - role: influencer
    permission:
      columns:
        - id
        - influencer_id
        - offer_id
        - order_id
        - comission
        - discount
        - order_total
        - order_type
      computed_fields:
        - loss
      filter:
        influencer:
          user_id:
            _eq: X-Hasura-User-Id
      allow_aggregations: true
    comment: ""
  - role: restaurant_operator
    permission:
      columns:
        - id
        - influencer_id
        - offer_id
        - order_id
        - comission
        - discount
        - order_total
        - order_type
      computed_fields:
        - loss
      filter:
        _or:
          - order_id:
              _is_null: true
          - restaurant_order:
              restaurant:
                restaurant_operators:
                  user_id:
                    _eq: X-Hasura-User-Id
      allow_aggregations: true
    comment: ""
